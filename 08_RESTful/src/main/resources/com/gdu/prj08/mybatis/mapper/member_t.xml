<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gdu.prj08.mybatis.mapper.file_t">
  
  <insert id="insertHistory"
          parameterType="HistoryDto">
    <selectKey keyProperty="historyNo" order="BEFORE"> <!-- HistoryDto에 있는 historyNo를 먼저 selectKey 안에 있는 쿼리문을 실행해라 -->
      SELECT HISTORY_SQL.NEXTVAL
        FROM DUAL
    </selectKey>
    INSERT INTO HISTORY_T () VALUES (
        HISTORY_NO
      , WRITER
      , IP
    ) VALUES (
        <!-- 원래는 이곳이 seq값을 넣는 자리. -->
        #{historyNo}
      , #{writer}
      , #{ip}
    )
          
  </insert>
  
  
  
  
  
  
  
  
  
  
  
  
  <insert id="uploadFile"
          parameterType="FileDto">
    INSERT INTO FILE_T (
        FILE_NO
      , UPLOAD_PATH
      , ORIGINAL_FILENAME
      , FILESYSTEM_NAME
      , HISTORY_NO
    ) VALUES (
        FILE_SEQ.NEXTVAL
      , #{uploadPath}
      , #{originalFileName}
      , #{filesystemName}
      , #{historyNo}
    )
  </insert>

</mapper>